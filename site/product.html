<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>kedufron't - Produit</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/4495018b32.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Protest+Riot&display=swap">
</head>
<body>
    <header>
        <div class="banner">
            <ul class="banner_utility_items">
                <li class="banner_utility-items -menu">
                    <i class="fa-solid fa-bars" style="color: #000000;"></i>
                </li>
                <li class="banner_utility-items -logo">
                    <h1 class="logo">KEDUTOYS</h1>
                </li>
                <li class="banner_utility-items -navbar">
                    <input type="text" placeholder="Recherche..." name="search">
                    <button type="submit"><i class="fa-solid fa-magnifying-glass" style="color: black;"></i></button>
                </li>
                <li class="banner_utility-items -connexion">
                    <i class="fa-solid fa-user" style="color: #000000;"></i>
                </li>
                <li class="banner_utility-items -panier">
                    <a href="./panier.html"><i class="fa-solid fa-basket-shopping" style="color: #000000;"></i></a>
                </li>
            </ul>
        </div>
    </header>
    <main>
        <div id="product-details">
            <!-- Les détails du produit seront insérés ici via JavaScript -->
        </div>
        <select id="quantiteSelect">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
    </main>
    <footer>
        <ul class="basdepage">
            <li class="bdp">
                <div class="flexi">
                    <h3>A propos</h3>
                    <p>Fonctionnement du site</p>
                    <p>Conditions générales de vente</p>
                    <p>Données et confidentialité</p>
                </div>
            </li>
            <li class="bdp">
                <div class="flexi">
                    <h3>Nos hébergements</h3>
                    <p>Charte qualité</p>
                    <p>Soumettre votre hôtel</p>
                </div>
            </li>
            <li class="bdp">
                <div class="flexi">
                    <h3>Assistance</h3>
                    <p>Centre d'aide</p>
                    <p>Nous contacter</p>
                </div>
            </li>
        </ul>
    </footer>

    <script>
        var selectedProductId = localStorage.getItem('selectedProductId');
    
        // Fetch des détails du produit et affichage
        fetch(`https://api.kedufront.juniortaker.com/item/${selectedProductId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur lors de la récupération des données');
                }
                return response.json();
            })
            .then(data => {
                var product = data.item;
                var productDetailsDiv = document.getElementById('product-details');
                productDetailsDiv.innerHTML = `
                    <img src="https://api.kedufront.juniortaker.com/item/picture/${product.image}" alt="${product.name}">
                    <div class="productinformations">
                        <h2 class="nameproduct">${product.name}</h2>
                        <p>Description: ${product.description}</p>
                        <p>Prix: ${product.price} €</p>
                    </div>
                `;
    
                // Vérifier si une quantité est déjà stockée pour ce produit
                var storedQuantity = localStorage.getItem(selectedProductId);
                if (storedQuantity !== null) {
                    quantiteSelect.value = storedQuantity; // Pré-sélectionner la quantité dans le sélecteur
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
            });
    
        // Ajout de l'événement change sur le select pour mettre à jour automatiquement le panier et le stockage local
        var quantiteSelect = document.getElementById('quantiteSelect');
        quantiteSelect.addEventListener('change', function() {
            var quantiteSelectionnee = quantiteSelect.value;
            updateQuantityInCart(selectedProductId, quantiteSelectionnee);
            localStorage.setItem(selectedProductId, quantiteSelectionnee); // Stocker la quantité sélectionnée dans le stockage local
        });
    
        // Fonction pour mettre à jour la quantité d'un article dans le panier
        function updateQuantityInCart(productId, newQuantity) {
            var found = false;
            var panier = JSON.parse(localStorage.getItem('panier')) || [];
            panier.forEach(function(article) {
                if (article.productId === productId) {
                    article.quantity = parseInt(newQuantity);
                    found = true;
                }
            });
            if (!found) {
                panier.push({ productId: productId, quantity: parseInt(newQuantity) });
            }
            localStorage.setItem('panier', JSON.stringify(panier));
        }
    </script>
    
</body>
</html>
